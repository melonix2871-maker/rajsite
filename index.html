<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Kwentong Lasing. Serves Beer Daily!</title>
  <link rel="icon" type="image/png" href="./resources/img/icon.png" />
  <link rel="stylesheet" href="./resources/css/main.css">

</head>
<body>
  <!-- Auth UI is commented out in your original code -->
  <!--
  <div id="auth-ui" style="margin-bottom:12px">
    <span id="user-echo">Read-only mode</span>
    <button id="sign-in-btn" onclick="window.location.href='login.html'">Admin Login</button>
    <button id="sign-out-btn" style="display:none">Sign out</button>
  </div>
  -->

<div id="page-wrapper" class="container">

  <header id="site-header" class="tabdesk-header">
    <div id="header-content">
       <a href="./"><img width="190" src="./resources/img/logo.png" alt="Kwentong Lasing"></a>
       <h3>The New Gig For The Drunkards.</h3>
        <ul>
          <li><a class="ignore" href="./index.html">üç∫ Home</a></li>        
          <li><a class="ignore" href="./community.html">üç∫ FAQ</a></li>   
          <li><a href="./rules.html">üç∫ Rules & Regulations</a></li>      
        </ul>
        <div id="login-btn">
          <a class="ignore" href="./login.html">Login</a>
        </div>

        <div id="online-users-counter" class="ignore"><span class="circ"></span> <b>125</b> users online now</div>

        <div id="kl_exchange">
          <h4 class="ignore">Beer Exchange üç∫ = üíµ </h4>
           <ul>
             <li> 1 Bottle = <span id="conversion" class="ignore">$5</span></li>
             <li> 1 Bucket = <span id="conversion" class="ignore">$30</span></li>
             <li> 1 Case = <span id="conversion" class="ignore">$60</span></li>
           </ul>
        </div>

        <!-- ADDED TRANSLATION WIDGET HERE -->
        <small class="ignore" style="text-align: center; text-transform: uppercase;margin-bottom: -12px;font-weight: bold;">Select Language:</small>
        <div class="switchlang ignore">
	    <a href="javascript:translate.changeLanguage('english');"><img width="15" src="./resources/img/flags/us.svg"/></a>
     	<a href="javascript:translate.changeLanguage('filipino');"><img width="15" src="./resources/img/flags/ph.svg"/></a>
	    <a href="javascript:translate.changeLanguage('chinese_traditional');"><img width="15" src="./resources/img/flags/cn.svg"/></a>
      <a href="javascript:translate.changeLanguage('french');"><img width="15" src="./resources/img/flags/fr.svg"/></a>
      <a href="javascript:translate.changeLanguage('spanish');"><img width="15" src="./resources/img/flags/es.svg"/></a>
      <a href="javascript:translate.changeLanguage('italian');"><img width="15" src="./resources/img/flags/it.svg"/></a>
      <a href="javascript:translate.changeLanguage('hindi');"><img width="15" src="./resources/img/flags/in.svg"/></a>
      <a href="javascript:translate.changeLanguage('russian');"><img width="15" src="./resources/img/flags/ru.svg"/></a>
      <a href="javascript:translate.changeLanguage('japanese');"><img width="15" src="./resources/img/flags/jp.svg"/></a>
      <a href="javascript:translate.changeLanguage('korean');"><img width="15" src="./resources/img/flags/kr.svg"/></a>     

        </div>
        <!-- END TRANSLATION WIDGET -->

      </div>
  </header>

  <header id="site-header" class="mobile-header">
   <div id="kl_exchange_mobile_marquee">
  <div class="marquee-content">
    <!-- Original content -->
    <div class="marquee-inner">
      <h4 class="ignore">Beer Exchange üç∫ = üíµ</h4>
      <div>1 Bottle = <span class="ignore">$5</span></div>
      <div>1 Bucket = <span class="ignore">$30</span></div>
      <div>1 Case = <span class="ignore">$60</span></div>
    </div>
    <!-- Duplicate for seamless loop -->
    <div class="marquee-inner" aria-hidden="true">
      <h4 class="ignore">Beer Exchange üç∫ = üíµ</h4>
      <div>1 Bottle = <span class="ignore">$5</span></div>
      <div>1 Bucket = <span class="ignore">$30</span></div>
      <div>1 Case = <span class="ignore">$60</span></div>
    </div>
  </div>
</div>  
    <img style="width:100%;" src="./resources/img/hero_img.jpg" alt="Kwentong Lasing">
    <div id="header-content">
      <div id="logo-mobile">
       <a href="./"><img width="190" src="./resources/img/logo.png" alt="Kwentong Lasing"></a>
       <button id="menu-toggle-btn"><img src="./resources/img/menu.svg"/></button>
      </div>

      <div id="mobile-menu-dp">
		    <ul>
          <li><a class="ignore" href="./index.html">üç∫ Home</a></li>        
          <li><a class="ignore" href="./community.html">üç∫ FAQ</a></li>   
          <li><a href="./rules.html">üç∫ Rules & Regulations</a></li> 
           <li id="login-btn"><a class="ignore" href="./login.html">üç∫ Login</a></li>		  
        </ul>
		</div>

       <div id="flags-mobile">
         <!-- ADDED TRANSLATION WIDGET HERE -->
        <small class="ignore" style="text-align: center; text-transform: uppercase;margin-bottom: -12px;font-weight: bold;">Select Language:</small>
        <div class="switchlang ignore" style="width: 100%;">
	    <a href="javascript:translate.changeLanguage('english');"><img width="15" src="./resources/img/flags/us.svg"/></a>
     	<a href="javascript:translate.changeLanguage('filipino');"><img width="15" src="./resources/img/flags/ph.svg"/></a>
	    <a href="javascript:translate.changeLanguage('chinese_traditional');"><img width="15" src="./resources/img/flags/cn.svg"/></a>
      <a href="javascript:translate.changeLanguage('french');"><img width="15" src="./resources/img/flags/fr.svg"/></a>
      <a href="javascript:translate.changeLanguage('spanish');"><img width="15" src="./resources/img/flags/es.svg"/></a>
      <a href="javascript:translate.changeLanguage('italian');"><img width="15" src="./resources/img/flags/it.svg"/></a>
      <a href="javascript:translate.changeLanguage('hindi');"><img width="15" src="./resources/img/flags/in.svg"/></a>
      <a href="javascript:translate.changeLanguage('russian');"><img width="15" src="./resources/img/flags/ru.svg"/></a>
      <a href="javascript:translate.changeLanguage('japanese');"><img width="15" src="./resources/img/flags/jp.svg"/></a>
      <a href="javascript:translate.changeLanguage('korean');"><img width="15" src="./resources/img/flags/kr.svg"/></a>     

        </div>
        <!-- END TRANSLATION WIDGET -->
         </div>
       <h3>The New Gig For The Drunkards.</h3>               
        <div id="online-users-counter" class="ignore"><span class="circ"></span> <b>125</b> users online now</div>
      </div>
  </header>

<main id="site-content">
<div id="header-hero-block">
  <img src="./resources/img/hero_img.jpg" alt="Kwentong Lasing">
  <div id="chat-bubble-box">
      <textarea id="chat-input" placeholder="Share your unique experience when you got drunk."></textarea>
      <div class="chat-tools">
        <div class="txtlimit">20/350</div>
      <button class="ignore" id="send-btn">üç∫ Share it!</button>
      </div>
  </div>
  <div id="story-title-bar">
    <h2>Latest Stories</h2>
  </div>
</div>

<div id="stories-block">
  <div id="stories-lists">
    <div id="stories-list"></div>
  </div>

  <div id="copyright" class="tabdesk-copyright">
    <div class="divider"></div>
    <div id="footer-logo">
      <img width="150" src="./resources/img/footer_logo.png" alt="Kwentong Lasing">
    </div>
    <ul>
      <li><a class="ignore" href="./index.html">Home</a></li>        
      <li><a class="ignore" href="./community.html">FAQ</a></li>   
      <li><a href="./rules.html">Rules & Regulations</a></li>
      <li><a href="#">Donate</a></li>
      <li><a href="#">Updates</a></li>
      <li><a href="#">Advertise</a></li>
      <li><a href="#">Merch</a></li>
      <li><a href="#">Privacy Policy</a></li>
      <li><a href="#">Terms</a></li>
    </ul>
    <p class="ignore">&copy; Copyright <script>document.write(new Date().getFullYear())</script> Kwentong Lasing Community. All Rights reserved.</p>
    <p class="ignore">A Romeo Asis Production</p>
  </div>
</main>

<div id="cabinet-block">
<div id="cabinet">
   <div id="side-widget">
      <h3>üç∫ Join Our Community</h3>
      <p>Spill your 'Kwentong Lasing' here‚Äîwhere legendary stories get the applause they deserve! Join now and let‚Äôs turn tipsy tales into cash.</p>      
    </div>

   <div id="side-widget">
     <h3>üç∫ Trending</h3>
     <ul class="trending-list">
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> Why do I always get drunk at family gatherings?</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> That time I got so drunk I tried to marry a lamp post</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> The Great Beer Spill of 2023: A Tragicomedy</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> How I ended up in a karaoke contest with a parrot</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> The time I mistook a fire hydrant for a urinal</a></li>
     </ul>

   </div>

   <div id="side-widget" class="ads_block">
     <h3>üç∫ Advertisement</h3>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
   </div>
   
</div>
</div>

<div id="copyright" class="mobile-copyright">
    <div class="divider"></div>
    <div id="footer-logo">
      <img width="150" src="./resources/img/footer_logo.png" alt="Kwentong Lasing">
    </div>
    <ul>
      <li><a class="ignore" href="./index.html">Home</a></li>        
      <li><a class="ignore" href="./community.html">FAQ</a></li>   
      <li><a href="./rules.html">Rules & Regulations</a></li>
      <li><a href="#">Donate</a></li>
      <li><a href="#">Updates</a></li>
      <li><a href="#">Advertise</a></li>
      <li><a href="#">Merch</a></li>
      <li><a href="#">Privacy Policy</a></li>
      <li><a href="#">Terms</a></li>
    </ul>
    <p class="ignore">&copy; Copyright <script>document.write(new Date().getFullYear())</script> Kwentong Lasing Community. All Rights reserved.</p>
    <p class="ignore">A Romeo Asis Production</p>
  </div>




</div>


<script src="https://translate.zvo.cn/static/translate.min.js"></script>
<script>
translate.element.tagAttribute['textarea']=['placeholder'];
translate.ignore.class.push('botts');
translate.language.setLocal('english');
translate.service.use('client.edge');
translate.listener.start();
translate.execute();
</script>
<script type="module">
import { DB, WriteQueue, buildAdapterFromConfig } from './coreenginedb/client.js'
let config={}
async function loadConfig(){ try{ const r=await fetch('https://assets.antserver1.eu.org/config.json'); if(r.ok) config=await r.json() }catch(_){} if(!config.defaultPrefix) config.defaultPrefix='app_'; config.snapshotUrl='https://coreenginedb.meoasis2014.workers.dev/json/public.db.json'; if(!config.http) config.http={}; config.http.url='https://coreenginedb.meoasis2014.workers.dev/json/db.json'; config.http.method='PUT'; try{ const a=sessionStorage.getItem('cedb_auth')||''; if(a){ if(!config.http.headers) config.http.headers={}; config.http.headers.Authorization=a } }catch(_){} }
function authUser(){ try{ return JSON.parse(sessionStorage.getItem('app_auth')||'null') }catch(_){ return null } }
function authorByRel(all, rel){ const urec=all.find(r=>String(r.prefix||'')==='app_'&&String(r.collection||'')==='users'&&Number(r.relid||0)===Number(rel||0)&&String(r.metakey||'')==='username'); const avatar=all.find(r=>String(r.prefix||'')==='app_'&&String(r.collection||'')==='users'&&Number(r.relid||0)===Number(rel||0)&&String(r.metakey||'')==='avatar'); return { name: urec&&String(urec.metavalue||'')||'', avatar: avatar&&String(avatar.metavalue||'')||'' } }
function listPosts(all){ return all.filter(r=>String(r.prefix||'')==='app_'&&String(r.collection||'')==='posts'&&String(r.metakey||'')==='content') }
async function fetchSnapshot(){ try{ const r=await fetch(config.snapshotUrl,{ cache:'no-store' }); if(r.ok){ const j=await r.json().catch(()=>null); if(Array.isArray(j)) return j } }catch(_){} try{ const auth = (config.http&&config.http.headers&&config.http.headers.Authorization)||''; if(auth){ const r=await fetch(config.http.url,{ cache:'no-store', headers:{ Authorization: auth } }); if(r.ok){ const j=await r.json().catch(()=>null); if(Array.isArray(j)) return j } } }catch(_){} return [] }
async function renderFeed(){ await loadConfig(); const adapter=buildAdapterFromConfig({ defaultPrefix: config.defaultPrefix, snapshotUrl: config.snapshotUrl, writeUrl: config.http.url, writeMethod: config.http.method, headers: (config.http&&config.http.headers)||{} }); const db=new DB(adapter); const q=new WriteQueue(db); db.queue=q; const data=await fetchSnapshot(); const posts=listPosts(data).slice().sort((a,b)=>String(b.updateddate||b.createddate||'').localeCompare(String(a.updateddate||a.createddate||''))); const el=document.getElementById('stories-list'); if(!el) return; const html = posts.length? posts.map(p=>{ const a=authorByRel(data, p.relid||0); const avatarHtml = (a.avatar&&a.avatar.startsWith('data:image/'))? `<img src="${a.avatar}"/>` : ''; const txt=(typeof p.metavalue==='object')? JSON.stringify(p.metavalue) : String(p.metavalue||''); return `<div id="story-heading"><div id="user-details">${avatarHtml}<p class="username ignore">${a.name||'Anonymous'} <span>${String(p.updateddate||p.createddate||'')}</span></p></div><p class="time"><span class="rate">Rating: <b>üç∫üç∫</b></span> <span class="more"><img src="./resources/img/more.svg"/></span></p></div><nav class="vertical-nav" id="verticalNav" style="display: none;"><ul><li><a href="#" class="nav-link">Share</a></li><li><a href="#" class="nav-link">Save</a></li><li><a href="#" class="nav-link">Report</a></li></ul></nav><p>${txt}</p><div id="stories-tools"><p class="ignore">Buy me a beer üëâ</p><div class="botts"><a href="#" data-act="beer" data-kind="bottle" data-post="${p.id}"><img width="18" src="./resources/img/1bott.svg"/></a><a href="#" data-act="beer" data-kind="bucket" data-post="${p.id}"><img width="18" src="./resources/img/2bott.svg"/></a><a href="#" data-act="beer" data-kind="case" data-post="${p.id}"><img width="18" src="./resources/img/3bott.svg"/></a><a href="#" data-act="beer" data-kind="bucket" data-post="${p.id}"><img width="18" src="./resources/img/bucket.svg"/></a><a href="#" data-act="beer" data-kind="case" data-post="${p.id}"><img width="18" src="./resources/img/case.svg"/></a></div><small>‚ö†Ô∏è No <b class="ignore">'likes'</b> here, that stuff isn't intoxicating. Buy us some beer.</small></div>` }).join('') : '<div class="muted">No stories yet</div>';
  el.innerHTML = html;
  el.addEventListener('click', async (e)=>{ const a=e.target.closest('a'); if(!a) return; if(a.getAttribute('data-act')==='beer'){ const app=authUser(); if(!app){ window.location.href='login.html'; return } const kind=a.getAttribute('data-kind')||'bottle'; const postId=Number(a.getAttribute('data-post')||'0'); const amt= kind==='bottle'?5: (kind==='bucket'?30:60); try{ const r=await fetch('https://coreenginedb.meoasis2014.workers.dev/donate',{ method:'POST', headers:{ 'Content-Type':'application/json', ...(config.http&&config.http.headers)||{} }, body: JSON.stringify({ postId, amount: amt, kind }) }); if(r.ok){ location.reload() } }catch(_){ } } })
}
renderFeed()
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
  let uname='';
  try{ const app = JSON.parse(sessionStorage.getItem('app_auth')||'null'); if(app && app.username){ uname=String(app.username) } }catch(_){}
  const loginLinks = Array.from(document.querySelectorAll('#login-btn a'));
  if(loginLinks.length){
    if(uname){
      loginLinks.forEach(a=>{ a.textContent = 'Welcome To KL, ' + uname; a.setAttribute('href','./dashboard.html') })
      const navUl = document.querySelector('.tabdesk-header ul')
      if(navUl){
        if(!document.getElementById('nav-profile')){ const li=document.createElement('li'); li.id='nav-profile'; const a=document.createElement('a'); a.className='ignore'; a.href='./profile.html?u='+encodeURIComponent(uname); a.textContent='üç∫ Profile'; li.appendChild(a); navUl.appendChild(li) }
        if(!document.getElementById('nav-dashboard')){ const li=document.createElement('li'); li.id='nav-dashboard'; const a=document.createElement('a'); a.href='./dashboard.html'; a.textContent='üç∫ Dashboard'; li.appendChild(a); navUl.appendChild(li) }
      }
      let lgc = document.getElementById('logout-btn');
      if(!lgc){ lgc = document.createElement('div'); lgc.id = 'logout-btn'; const parent = document.querySelector('.tabdesk-header #header-content'); if(parent) parent.appendChild(lgc) }
      lgc.innerHTML = '<a href="#" id="logout-link">Logout</a>'
      const lnk = document.getElementById('logout-link');
      if(lnk){ lnk.addEventListener('click', (e)=>{ e.preventDefault(); try{ sessionStorage.removeItem('app_auth'); sessionStorage.removeItem('cedb_auth') }catch(_e){} window.location.href = './login.html' }) }
      const mobileUl = document.querySelector('#mobile-menu-dp ul');
      if(mobileUl && !document.getElementById('logout-menu-item')){
        const li = document.createElement('li'); li.id='logout-menu-item'; const a=document.createElement('a'); a.textContent='üç∫ Logout'; a.href='#'; a.addEventListener('click',(e)=>{ e.preventDefault(); try{ sessionStorage.removeItem('app_auth'); sessionStorage.removeItem('cedb_auth') }catch(_e){} window.location.href='./login.html' }); li.appendChild(a); mobileUl.appendChild(li);
      }
    } else {
      loginLinks.forEach(a=>{ a.textContent = a.textContent.includes('üç∫') ? 'üç∫ Login' : 'Login'; a.setAttribute('href','./login.html') })
      const lgc = document.getElementById('logout-btn'); if(lgc) lgc.remove();
      const li = document.getElementById('logout-menu-item'); if(li) li.remove();
    }
  }
  const moreButton = document.querySelector('.more');
  const verticalNav = document.getElementById('verticalNav');
  if(moreButton && verticalNav){
  moreButton.addEventListener('click', function(e) {
    e.stopPropagation(); // Prevent event bubbling
    
    // Toggle the navigation visibility
    if (verticalNav.style.display === 'none' || verticalNav.style.display === '') {
      verticalNav.style.display = 'block';
    } else {
      verticalNav.style.display = 'none';
    }
  });
  
  // Close nav when clicking anywhere outside
  document.addEventListener('click', function(e) {
    if (!verticalNav.contains(e.target) && !moreButton.contains(e.target)) {
      verticalNav.style.display = 'none';
    }
  });
  
  // Optional: Close nav when clicking on a link
  const navLinks = document.querySelectorAll('.nav-link');
  navLinks.forEach(link => {
    link.addEventListener('click', function() {
      verticalNav.style.display = 'none';
    });
  });
  }

  const sendBtn = document.getElementById('send-btn');
  if(sendBtn){
    sendBtn.addEventListener('click', async function(){
      try{
        const app = JSON.parse(sessionStorage.getItem('app_auth')||'null');
        if(!app || !app.username){ window.location.href='login.html'; return }
        const text = String(document.getElementById('chat-input').value||'').trim();
        if(!text){ return }
        const WRITE_DB_URL = (function(){ try{ if(window.__REMOTE && window.__REMOTE.dbUrl) return String(window.__REMOTE.dbUrl) }catch(_){} return atob('aHR0cHM6Ly9jb3JlZW5naW5lZGIubWVvYXNpczIwMTQud29ya2Vycy5kZXYvanNvbi9kYi5qc29u') })();
        const auth = sessionStorage.getItem('cedb_auth')||'';
        const head = await fetch(WRITE_DB_URL,{ method:'HEAD' });
        const et = head.headers.get('etag')||'';
        const rows = await (await fetch(WRITE_DB_URL)).json().catch(()=>[]);
        if(!Array.isArray(rows)){ return }
        const now = new Date().toISOString();
        const relid = Number(app.relid||0) || 999;
        rows.push({ id: crypto.randomUUID(), relid, prefix:'app_', collection:'posts', metakey:'content', metavalue:text, createddate: now, updateddate: now });
        const r = await fetch(WRITE_DB_URL, { method:'PUT', headers: Object.assign({ 'Content-Type':'application/json' }, et? { 'If-Match': et } : {}, auth? { 'Authorization': auth } : {}), body: JSON.stringify(rows,null,2), mode:'cors', credentials:'omit' });
        if(r.ok){ document.getElementById('chat-input').value=''; location.reload() }
      }catch(_){ }
    })
  }

// Get the button and menu elements
const menuToggleBtn = document.getElementById('menu-toggle-btn');
const mobileMenu = document.getElementById('mobile-menu-dp');

// Add click event listener to the button
menuToggleBtn.addEventListener('click', function(event) {
    // Toggle the display of the mobile menu
    if (mobileMenu.style.display === 'none' || mobileMenu.style.display === '') {
        mobileMenu.style.display = 'block';
    } else {
        mobileMenu.style.display = 'none';
    }
    
    // Optional: Prevent event bubbling if needed
    event.stopPropagation();
});

// Optional: Close menu when clicking outside
document.addEventListener('click', function(event) {
    if (!mobileMenu.contains(event.target) && !menuToggleBtn.contains(event.target)) {
        mobileMenu.style.display = 'none';
    }
});


});
</script>
</body>
</html>
