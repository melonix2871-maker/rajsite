<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin</title>
</head>
<body>
<div id="auth-bar" style="display:flex;gap:12px;align-items:center">
  <span id="auth-status"></span>
  <button id="logout" style="display:none">Logout</button>
</div>
<h1>Add Record</h1>
<form id="row-form">
  <label>Name <input type="text" id="name" required></label>
  <label>Height <input type="number" id="height" required></label>
  <label>Weight <input type="number" id="weight" required></label>
  <label>Date <input type="text" id="date" required></label>
  <label>Info <input type="text" id="info"></label>
  <label>Country <input type="text" id="country" required></label>
  <button type="submit">Create</button>
</form>
<div id="status" style="margin-top:12px"></div>
<div style="margin-top:12px"><a href="db.html">Open Data Table</a></div>
<script src="https://js.puter.com/v2/"></script>
<script>
async function guard(){
  try{
    if(!puter.auth.isSignedIn()){ window.location.href='login.html'; return; }
    const u = await puter.auth.getUser();
    const s = document.getElementById('auth-status');
    s.textContent = 'Signed in as: ' + (u&&u.username||'');
    document.getElementById('logout').style.display='';
  }catch(_e){ window.location.href='login.html'; return; }
}
document.getElementById('logout').addEventListener('click', async ()=>{ try{ await puter.auth.signOut(); }catch(_e){} window.location.href='login.html'; });
guard();
const KEY='records';
async function cloudLoad(){try{const b=await puter.fs.read('records.json');const t=await b.text();const j=JSON.parse(t);if(Array.isArray(j))return j}catch(_e){}return null}
async function cloudSave(records){try{await puter.fs.write('records.json',new Blob([JSON.stringify(records)],{type:'application/json'}))}catch(_e){}}
function load(){const s=localStorage.getItem(KEY);return s?JSON.parse(s):[]}
function save(records){localStorage.setItem(KEY,JSON.stringify(records))}
function nextSeq(records){let m=0;for(const r of records){const v=Number(r.seq)||0;if(v>m)m=v}return m+1}
document.getElementById('row-form').addEventListener('submit',async e=>{e.preventDefault();const name=document.getElementById('name').value.trim();const height=document.getElementById('height').value.trim();const weight=document.getElementById('weight').value.trim();const date=document.getElementById('date').value.trim();const info=document.getElementById('info').value.trim();const country=document.getElementById('country').value.trim();if(!name||!height||!weight||!date||!country)return;let records=await cloudLoad();if(!records)records=load();const id=crypto.randomUUID();const seq=nextSeq(records);records.push({id,seq,user_link:`/username/${encodeURIComponent(name)}/`,name,height,weight,date,info,country});save(records);await cloudSave(records);document.getElementById('status').textContent='Saved. Seq '+seq;e.target.reset()})
</script>
</body>
</html>
