<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Source</title>
</head>
<body>
 <div>details here storage db limit</div> 
<table class="table-list table table-responsive table-striped">
<thead>
  <tr>
    <th class="coll-0">id</th>
    <th class="coll-1 name">name</th>
    <th class="coll-2">height</th>
    <th class="coll-3">weight</th>
    <th class="coll-date">date</th>
    <th class="coll-4"><span class="info">info</span></th>
    <th class="coll-5">country</th>
    <th class="coll-6">actions</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="coll-0">1</td>
    <td class="coll-1 name">
      <a href="/username/Jhon Doe/" class="icon"><i class="flaticon-user"></i></a>
      <a href="/username/Jhon Doe/">Jhon Doe</a>
    </td>
    <td class="coll-2 height">45</td>
    <td class="coll-3 weight">50</td>
    <td class="coll-date">9am May. 16th</td>
    <td class="coll-4 size mob-info">abcd</td>
    <td class="coll-5 country"><a href="/country/CA/">CA</a></td>
  </tr>
  <tr>
    <td class="coll-0">2</td>
    <td class="coll-1 name">
      <a href="/username/Kasim Shk/" class="icon"><i class="flaticon-user"></i></a>
      <a href="/username/Kasim Shk/">Kasim Shk</a>
    </td>
    <td class="coll-2 height">33</td>
    <td class="coll-3 weight">54</td>
    <td class="coll-date">Mar. 14th '18</td>
    <td class="coll-4 size mob-info">ijkl</td>
    <td class="coll-5 country"><a href="/country/UAE/">UAE</a></td>
  </tr>
</tbody>
</table>
<hr>
<h1>Add Row</h1>
<form id="row-form">
  <input type="hidden" id="id">
  <label>Name <input type="text" id="name" required></label>
  <label>Height <input type="number" id="height" required></label>
  <label>Weight <input type="number" id="weight" required></label>
  <label>Date <input type="text" id="date" required></label>
  <label>Info <input type="text" id="info"></label>
  <label>Country <input type="text" id="country" required></label>
  <button type="submit">Create</button>
  <button type="button" id="update-btn" style="display:none">Update</button>
  <button type="button" id="cancel-btn" style="display:none">Cancel</button>
</form>
<div id="auth-bar" style="display:flex;gap:12px;align-items:center;margin-top:8px">
  <span id="auth-status"></span>
  <button id="logout" style="display:none">Logout</button>
  <button id="export-json">Export JSON</button>
  <input type="file" id="import-json" accept="application/json">
  </div>
<script src="https://js.puter.com/v2/"></script>
<script>
const KEY='records';
function parseTbody(){const rows=[...document.querySelectorAll('tbody tr')];const out=[];for(const row of rows){const tds=row.querySelectorAll('td');if(tds.length<7) continue;const nameCell=tds[1];const a=nameCell.querySelector('a[href*="/username/"]');const user_link=a?a.getAttribute('href'):'';const name=(a&&a.textContent)||nameCell.textContent.trim();const height=tds[2].textContent.trim();const weight=tds[3].textContent.trim();const date=tds[4].textContent.trim();const info=tds[5].textContent.trim();const cc=tds[6];const ca=cc.querySelector('a');const country=ca?ca.textContent.trim():cc.textContent.trim();out.push({id:crypto.randomUUID(),user_link,name,height,weight,date,info,country})}return out}
function assignSeq(records){return records.map((r,i)=>({...r,seq:i+1}))}
function save(records){localStorage.setItem(KEY,JSON.stringify(records))}
function load(){const s=localStorage.getItem(KEY);return s?JSON.parse(s):null}
async function cloudLoad(){try{const b=await puter.fs.read('records.json');const t=await b.text();const j=JSON.parse(t);if(Array.isArray(j))return j}catch(_e){}return null}
async function cloudSave(records){try{await puter.fs.write('records.json',new Blob([JSON.stringify(records)],{type:'application/json'}))}catch(_e){}}
function render(records){const tb=document.querySelector('tbody');tb.innerHTML='';for(const r of records){const userHref=r.user_link||`/username/${encodeURIComponent(r.name)}/`;const countryHref=`/country/${encodeURIComponent(r.country)}/`;const tr=document.createElement('tr');tr.innerHTML=`<td class="coll-0">${r.seq||''}</td><td class="coll-1 name"><a href="${userHref}" class="icon"><i class="flaticon-user"></i></a><a href="${userHref}">${r.name}</a></td><td class="coll-2 height">${r.height}</td><td class="coll-3 weight">${r.weight}</td><td class="coll-date">${r.date}</td><td class="coll-4 size mob-info">${r.info||''}</td><td class="coll-5 country"><a href="${countryHref}">${r.country}</a></td><td class="coll-6"><button data-action="edit" data-id="${r.id}">Edit</button><button data-action="delete" data-id="${r.id}">Delete</button></td>`;tb.appendChild(tr)}}
async function ensure(){const cloud=await cloudLoad();if(cloud){const seqd=assignSeq(cloud);save(seqd);render(seqd)}else{const cur=load();if(cur){const seqd=assignSeq(cur);save(seqd);render(seqd)}else{const seed=parseTbody();const seqd=assignSeq(seed);save(seqd);render(seqd)}}}
async function guard(){try{if(!puter.auth.isSignedIn()){window.location.href='login.html';return;}const u=await puter.auth.getUser();document.getElementById('auth-status').textContent='Signed in as: '+(u&&u.username||'');document.getElementById('logout').style.display='';}catch(_e){window.location.href='login.html';return;}}
document.getElementById('logout').addEventListener('click',async()=>{try{await puter.auth.signOut();}catch(_e){}window.location.href='login.html';});
guard();
document.getElementById('row-form').addEventListener('submit',async e=>{e.preventDefault();const name=document.getElementById('name').value.trim();const height=document.getElementById('height').value.trim();const weight=document.getElementById('weight').value.trim();const date=document.getElementById('date').value.trim();const info=document.getElementById('info').value.trim();const country=document.getElementById('country').value.trim();if(!name||!height||!weight||!date||!country) return;let records=await cloudLoad();if(!records)records=load()||parseTbody();const id=crypto.randomUUID();records.push({id,seq:records.length+1,user_link:`/username/${encodeURIComponent(name)}/`,name,height,weight,date,info,country});save(records);await cloudSave(records);render(records);e.target.reset()})
document.querySelector('tbody').addEventListener('click',async e=>{const t=e.target;if(!(t instanceof Element)) return;const a=t.getAttribute('data-action');if(!a) return;const id=t.getAttribute('data-id');let records=await cloudLoad();if(!records)records=load()||parseTbody();if(a==='delete'){records=records.filter(x=>x.id!==id);records=assignSeq(records);save(records);await cloudSave(records);render(records)}else if(a==='edit'){const r=records.find(x=>x.id===id);if(!r) return;document.getElementById('id').value=r.id;document.getElementById('name').value=r.name;document.getElementById('height').value=r.height;document.getElementById('weight').value=r.weight;document.getElementById('date').value=r.date;document.getElementById('info').value=r.info||'';document.getElementById('country').value=r.country;document.querySelector('#row-form button[type="submit"]').style.display='none';document.getElementById('update-btn').style.display='';document.getElementById('cancel-btn').style.display=''}})
document.getElementById('update-btn').addEventListener('click',async()=>{const id=document.getElementById('id').value;let records=await cloudLoad();if(!records)records=load()||parseTbody();const idx=records.findIndex(x=>x.id===id);if(idx!==-1){const seq=records[idx].seq;records[idx]={id,seq,user_link:`/username/${encodeURIComponent(document.getElementById('name').value.trim())}/`,name:document.getElementById('name').value.trim(),height:document.getElementById('height').value.trim(),weight:document.getElementById('weight').value.trim(),date:document.getElementById('date').value.trim(),info:document.getElementById('info').value.trim(),country:document.getElementById('country').value.trim()};save(records);await cloudSave(records);render(records);clearForm()}})
ensure()
window.addEventListener('storage',e=>{if(e.key===KEY){const cur=load();const seqd=assignSeq(cur||parseTbody());save(seqd);render(seqd)}})
document.getElementById('export-json').addEventListener('click',()=>{const data=JSON.stringify(load()||parseTbody(),null,2);const blob=new Blob([data],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='records.json';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(a.href)})
document.getElementById('import-json').addEventListener('change',e=>{const f=e.target.files[0];if(!f)return;const reader=new FileReader();reader.onload=()=>{try{const list=JSON.parse(String(reader.result));if(Array.isArray(list)){const seqd=assignSeq(list);save(seqd);render(seqd)}}catch(_e){}e.target.value=''};reader.readAsText(f)})
</script>
</body>
</html>
