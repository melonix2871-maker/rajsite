<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
</head>
<body>
<div style="display:flex;align-items:center;gap:10px;margin-bottom:16px">
  <img alt="Logo" width="36" height="36" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Crect width='36' height='36' rx='8' fill='%230066ff'/%3E%3Ctext x='18' y='23' font-size='16' text-anchor='middle' fill='white' font-family='Arial'%3EJ%3C/text%3E%3C/svg%3E">
  <span style="font-size:18px;font-weight:600">Admin Login</span>
</div>
<h1>Login</h1>
<div id="status" style="margin-bottom:12px"></div>
<div style="margin-top:6px;font-size:13px">
  <span id="config-status" style="color:#a00"></span>
  <button id="recheck-config" onclick="checkConfigJs()" style="margin-left:8px;padding:4px 8px">Recheck config</button>
</div>
<form id="login-form" style="margin-top:12px;max-width:360px">
  <label style="display:block;margin:8px 0">Username <input id="login-username" autocomplete="username"></label>
  <label style="display:block;margin:8px 0">Password <input id="login-password" type="password" autocomplete="current-password"></label>
  <button type="submit">Sign In</button>
</form>
<div style="margin-top:12px"><a href="index.html">Back to Home</a></div>
<script src="config.js"></script>
<script>
function getCoreUrls(){
  const ce = (window.__CONFIG && window.__CONFIG.coreengine) || {}
  return { configUrl: ce.configUrl || '', dbUrl: ce.dbUrl || '' }
}
<script>
// Diagnostic: check config.js is served and show status
async function checkConfigJs(){
  const el = document.getElementById('config-status');
  if(!el) return;
  try{
    const r = await fetch('config.js', { cache: 'no-store' });
    if(r.ok){
      el.textContent = '✅ config.js loaded';
      el.style.color = '#070';
    } else {
      el.textContent = '❌ config.js not found (HTTP ' + r.status + ')';
      el.style.color = '#a00';
    }
  }catch(e){
    el.textContent = '❌ config.js fetch error';
    el.style.color = '#a00';
    console.error('checkConfigJs error', e);
  }
}
checkConfigJs();
async function tryLogin(username, password){
  try{
    const { dbUrl } = getCoreUrls()
    if(!dbUrl){ document.getElementById('status').textContent = '❌ Missing CoreEngineDB URL'; return }
    const auth = 'Basic ' + btoa(String(username)+':'+String(password))
    const r = await fetch(dbUrl, { method:'HEAD', headers: { 'Authorization': auth }, mode:'cors', credentials:'omit' })
    if(r.ok){ sessionStorage.setItem('cedb_auth', auth); window.location.href='admin.html'; }
    else { document.getElementById('status').textContent = '❌ Invalid credentials'; }
  }catch(e){ document.getElementById('status').textContent = '❌ Login error' }
}
document.getElementById('login-form').addEventListener('submit', (e)=>{
  e.preventDefault()
  const u = document.getElementById('login-username').value.trim()
  const p = document.getElementById('login-password').value.trim()
  if(!u || !p){ document.getElementById('status').textContent = 'Enter username and password'; return }
  tryLogin(u,p)
})
</script>
</body>
</html>
