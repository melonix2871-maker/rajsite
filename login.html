<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Kwentong Lasing. Serves Beer Daily!</title>
  <link rel="icon" type="image/png" href="./resources/img/icon.png" />
  <link rel="stylesheet" href="./resources/css/main.css">

</head>
<body>
  <!-- Auth UI is commented out in your original code -->
  <!--
  <div id="auth-ui" style="margin-bottom:12px">
    <span id="user-echo">Read-only mode</span>
    <button id="sign-in-btn" onclick="window.location.href='login.html'">Admin Login</button>
    <button id="sign-out-btn" style="display:none">Sign out</button>
  </div>
  -->

<div id="page-wrapper" class="container">

  <header id="site-header" class="tabdesk-header">
    <div id="header-content">
       <a href="./"><img width="190" src="./resources/img/logo.png" alt="Kwentong Lasing"></a>
       <h3>The New Gig For The Drunkards.</h3>
        <ul>
          <li><a class="ignore" href="./index.html">üç∫ Home</a></li>        
          <li><a class="ignore" href="./community.html">üç∫ FAQ</a></li>   
          <li><a href="./rules.html">üç∫ Rules & Regulations</a></li>      
        </ul>
        
        <div id="online-users-counter" class="ignore"><span class="circ"></span> <b>125</b> users online now</div>

        <div id="kl_exchange">
          <h4 class="ignore">Beer Exchange üç∫ = üíµ </h4>
           <ul>
             <li> 1 Bottle = <span id="conversion" class="ignore">$5</span></li>
             <li> 1 Bucket = <span id="conversion" class="ignore">$30</span></li>
             <li> 1 Case = <span id="conversion" class="ignore">$60</span></li>
           </ul>
        </div>

        <!-- ADDED TRANSLATION WIDGET HERE -->
        <small class="ignore" style="text-align: center; text-transform: uppercase;margin-bottom: -12px;font-weight: bold;">Select Language:</small>
        <div class="switchlang ignore">
	    <a href="javascript:translate.changeLanguage('english');"><img width="15" src="./resources/img/flags/us.svg"/></a>
     	<a href="javascript:translate.changeLanguage('filipino');"><img width="15" src="./resources/img/flags/ph.svg"/></a>
	    <a href="javascript:translate.changeLanguage('chinese_traditional');"><img width="15" src="./resources/img/flags/cn.svg"/></a>
      <a href="javascript:translate.changeLanguage('french');"><img width="15" src="./resources/img/flags/fr.svg"/></a>
      <a href="javascript:translate.changeLanguage('spanish');"><img width="15" src="./resources/img/flags/es.svg"/></a>
      <a href="javascript:translate.changeLanguage('italian');"><img width="15" src="./resources/img/flags/it.svg"/></a>
      <a href="javascript:translate.changeLanguage('hindi');"><img width="15" src="./resources/img/flags/in.svg"/></a>
      <a href="javascript:translate.changeLanguage('russian');"><img width="15" src="./resources/img/flags/ru.svg"/></a>
      <a href="javascript:translate.changeLanguage('japanese');"><img width="15" src="./resources/img/flags/jp.svg"/></a>
      <a href="javascript:translate.changeLanguage('korean');"><img width="15" src="./resources/img/flags/kr.svg"/></a>     

        </div>
        <!-- END TRANSLATION WIDGET -->

      </div>
  </header>

  <header id="site-header" class="mobile-header">
   <div id="kl_exchange_mobile_marquee">
  <div class="marquee-content">
    <!-- Original content -->
    <div class="marquee-inner">
      <h4 class="ignore">Beer Exchange üç∫ = üíµ</h4>
      <div>1 Bottle = <span class="ignore">$5</span></div>
      <div>1 Bucket = <span class="ignore">$30</span></div>
      <div>1 Case = <span class="ignore">$60</span></div>
    </div>
    <!-- Duplicate for seamless loop -->
    <div class="marquee-inner" aria-hidden="true">
      <h4 class="ignore">Beer Exchange üç∫ = üíµ</h4>
      <div>1 Bottle = <span class="ignore">$5</span></div>
      <div>1 Bucket = <span class="ignore">$30</span></div>
      <div>1 Case = <span class="ignore">$60</span></div>
    </div>
  </div>
</div>  
    <img style="width:100%;" src="./resources/img/hero_img.jpg" alt="Kwentong Lasing">
    <div id="header-content">
      <div id="logo-mobile">
       <a href="./"><img width="190" src="./resources/img/logo.png" alt="Kwentong Lasing"></a>
       <button id="menu-toggle-btn"><img src="./resources/img/menu.svg"/></button>
      </div>

      <div id="mobile-menu-dp">
		    <ul>
          <li><a class="ignore" href="./index.html">üç∫ Home</a></li>        
          <li><a class="ignore" href="./community.html">üç∫ FAQ</a></li>   
          <li><a href="./rules.html">üç∫ Rules & Regulations</a></li> 
           <li id="login-btn"><a class="ignore" href="./login.html">üç∫ Login</a></li>		  
        </ul>
		</div>

       <div id="flags-mobile">
         <!-- ADDED TRANSLATION WIDGET HERE -->
        <small class="ignore" style="text-align: center; text-transform: uppercase;margin-bottom: -12px;font-weight: bold;">Select Language:</small>
        <div class="switchlang ignore" style="width: 100%;">
	    <a href="javascript:translate.changeLanguage('english');"><img width="15" src="./resources/img/flags/us.svg"/></a>
     	<a href="javascript:translate.changeLanguage('filipino');"><img width="15" src="./resources/img/flags/ph.svg"/></a>
	    <a href="javascript:translate.changeLanguage('chinese_traditional');"><img width="15" src="./resources/img/flags/cn.svg"/></a>
      <a href="javascript:translate.changeLanguage('french');"><img width="15" src="./resources/img/flags/fr.svg"/></a>
      <a href="javascript:translate.changeLanguage('spanish');"><img width="15" src="./resources/img/flags/es.svg"/></a>
      <a href="javascript:translate.changeLanguage('italian');"><img width="15" src="./resources/img/flags/it.svg"/></a>
      <a href="javascript:translate.changeLanguage('hindi');"><img width="15" src="./resources/img/flags/in.svg"/></a>
      <a href="javascript:translate.changeLanguage('russian');"><img width="15" src="./resources/img/flags/ru.svg"/></a>
      <a href="javascript:translate.changeLanguage('japanese');"><img width="15" src="./resources/img/flags/jp.svg"/></a>
      <a href="javascript:translate.changeLanguage('korean');"><img width="15" src="./resources/img/flags/kr.svg"/></a>     

        </div>
        <!-- END TRANSLATION WIDGET -->
         </div>
       <h3>The New Gig For The Drunkards.</h3>               
        <div id="online-users-counter" class="ignore"><span class="circ"></span> <b>125</b> users online now</div>
      </div>
  </header>

<main id="site-content">
<div id="header-hero-block">
  <img src="./resources/img/hero_img.jpg" alt="Kwentong Lasing"> 
  <div id="story-title-bar">
    <h1 class="ignore">Login</h1>
  </div>
<div id="status" style="margin-bottom:12px"></div>
<form id="login-form">
  <input type="hidden" id="csrf-login-token" name="csrf_token">
  <label>Username <input id="login-username" autocomplete="username"></label>
  <label>Password <input id="login-password" type="password" autocomplete="current-password"></label>
  <button type="submit" class="ignore">Sign In</button>
</form>
<div id="or-divider" class="ignore">OR</div>
<div style="margin-top:34px">
   <div id="story-title-bar">
    <h1 class="ignore">Register</h1>
  </div>
   <div id="register-status" style="margin-top:8px"></div>
  <form id="register-form">
    <input type="hidden" id="csrf-register-token" name="csrf_token">
    <label>Username <input id="reg-username" autocomplete="username"></label>
    <label>Password <input id="reg-password" type="password" autocomplete="new-password"></label>
    <label>Confirm <input id="reg-confirm" type="password" autocomplete="new-password"></label>
    <button type="submit" class="ignore">Create Account</button>
  </form>
 
</div>

<div id="copyright" class="tabdesk-copyright">
    <div class="divider"></div>
    <div id="footer-logo">
      <img width="150" src="./resources/img/footer_logo.png" alt="Kwentong Lasing">
    </div>
    <ul>
      <li><a class="ignore" href="./index.html">Home</a></li>        
      <li><a class="ignore" href="./community.html">FAQ</a></li>   
      <li><a href="./rules.html">Rules & Regulations</a></li>
      <li><a href="#">Donate</a></li>
      <li><a href="#">Updates</a></li>
      <li><a href="#">Advertise</a></li>
      <li><a href="#">Merch</a></li>
      <li><a href="#">Privacy Policy</a></li>
      <li><a href="#">Terms</a></li>
    </ul>
    <p class="ignore">&copy; Copyright <script>document.write(new Date().getFullYear())</script> Kwentong Lasing Community. All Rights reserved.</p>
    <p class="ignore">A Romeo Asis Production</p>
  </div>
</main>

<div id="cabinet-block">
<div id="cabinet">
   <div id="side-widget">
      <h3>üç∫ Join Our Community</h3>
      <p>Spill your 'Kwentong Lasing' here‚Äîwhere legendary stories get the applause they deserve! Join now and let‚Äôs turn tipsy tales into cash.</p>      
    </div>

   <div id="side-widget">
     <h3>üç∫ Trending</h3>
     <ul class="trending-list">
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> Why do I always get drunk at family gatherings?</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> That time I got so drunk I tried to marry a lamp post</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> The Great Beer Spill of 2023: A Tragicomedy</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> How I ended up in a karaoke contest with a parrot</a></li>
        <li><a href="#"><img class="use32_avatar" width="32" src="https://i.pravatar.cc/40"/> The time I mistook a fire hydrant for a urinal</a></li>
     </ul>

   </div>

   <div id="side-widget" class="ads_block">
     <h3>üç∫ Advertisement</h3>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
      <div id="ad-space">
        <img src="./resources/img/ad_placeholder.png" alt="Advertise Here"/>
      </div>
   </div>
   
</div>
</div>

<div id="copyright" class="mobile-copyright">
    <div class="divider"></div>
    <div id="footer-logo">
      <img width="150" src="./resources/img/footer_logo.png" alt="Kwentong Lasing">
    </div>
    <ul>
      <li><a class="ignore" href="./index.html">Home</a></li>        
      <li><a class="ignore" href="./community.html">FAQ</a></li>   
      <li><a href="./rules.html">Rules & Regulations</a></li>
      <li><a href="#">Donate</a></li>
      <li><a href="#">Updates</a></li>
      <li><a href="#">Advertise</a></li>
      <li><a href="#">Merch</a></li>
      <li><a href="#">Privacy Policy</a></li>
      <li><a href="#">Terms</a></li>
    </ul>
    <p class="ignore">&copy; Copyright <script>document.write(new Date().getFullYear())</script> Kwentong Lasing Community. All Rights reserved.</p>
    <p class="ignore">A Romeo Asis Production</p>
  </div>




</div>



<script>
const WRITE_CONFIG_URL = 'https://coreenginedb.meoasis2014.workers.dev/json/config.json'
const WRITE_DB_URL = 'https://coreenginedb.meoasis2014.workers.dev/json/db.json'
function getCoreUrls(){ return { configUrl: WRITE_CONFIG_URL, dbUrl: WRITE_DB_URL } }
try{ const app = JSON.parse(sessionStorage.getItem('app_auth')||'null'); if(app && String(app.role||'')==='superadmin'){ window.location.href='admin.html' } else if(app){ window.location.href='index.html' } }catch(_){}
</script>
<script>
async function tryLogin(username, password){
  try{
    async function readRowsSafely(){
      const urls=[WRITE_DB_URL, 'https://assets.antserver1.eu.org/db.json']
      for(const u of urls){
        try{ const r=await fetch(u, { cache:'no-store', mode:'cors', credentials:'omit' }); if(r.ok){ const t=await r.text(); try{ const j=JSON.parse(t); if(Array.isArray(j)) return j }catch(_){ } } }catch(_e){}
      }
      return []
    }
    const rows = await readRowsSafely()
    if(!Array.isArray(rows) || !rows.length){ document.getElementById('status').textContent='‚ùå Cannot read users'; return }
    const suRow = rows.find(r => String(r.prefix||'')==='coreenginedb_' && String(r.collection||'')==='superuser' && String(r.metakey||'')===String(username)) || null
    if(suRow && String(suRow.metavalue||'')===String(password)){
      sessionStorage.setItem('app_auth', JSON.stringify({ role:'superadmin', username }))
      sessionStorage.setItem('cedb_auth', 'Basic '+ btoa(String(username)+':'+String(password)))
      window.location.href='admin.html'
      return
    }
    const urec = rows.find(r => String(r.prefix||'')==='app_' && String(r.collection||'')==='users' && String(r.metakey||'')==='username' && String(r.metavalue||'')===String(username)) || null
    if(urec){
      const passrec = rows.find(r => String(r.prefix||'')==='app_' && String(r.collection||'')==='users' && String(r.metakey||'')==='password' && Number(r.relid||0)===Number(urec.relid||0)) || null
      if(passrec){
        let ok=false
        try{
          const payload = typeof passrec.metavalue==='string'? JSON.parse(passrec.metavalue) : passrec.metavalue
          if(payload && payload.hash && payload.salt && payload.iterations){
            const calc = await pbkdf2Hex(password, String(payload.salt), Number(payload.iterations||100000), 32)
            ok = (String(calc) === String(payload.hash))
          }
        }catch(_){ ok=false }
        if(!ok){ ok = (String(passrec.metavalue||'')===String(password)) }
        if(ok){
          sessionStorage.setItem('app_auth', JSON.stringify({ role:'user', username, relid:Number(urec.relid||0) }))
          window.location.href='index.html'
          return
        }
      }
    }
    document.getElementById('status').textContent='‚ùå Invalid credentials'
  }catch(e){ document.getElementById('status').textContent='‚ùå Login error' }
}
document.getElementById('login-form').addEventListener('submit', (e)=>{
  e.preventDefault()
  const u = document.getElementById('login-username').value.trim()
  const p = document.getElementById('login-password').value.trim()
  if(!u || !p){ document.getElementById('status').textContent = 'Enter username and password'; return }
  tryLogin(u,p)
})
function hex(buf){ return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('') }
function randHex(n){ const a=new Uint8Array(n); crypto.getRandomValues(a); return Array.from(a).map(b=>b.toString(16).padStart(2,'0')).join('') }
async function pbkdf2Hex(password, salt, iterations, length){ const enc = new TextEncoder(); const key = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveBits']); const bits = await crypto.subtle.deriveBits({ name:'PBKDF2', hash:'SHA-256', salt: enc.encode(salt), iterations }, key, (length||32)*8); return hex(bits) }
async function readConfig(){ try{ const { configUrl } = getCoreUrls(); const r = await fetch(configUrl, { cache:'no-store', mode:'cors', credentials:'omit' }); if(!r.ok) return {}; const et=r.headers.get('etag'); if(et) window.cedbEtag = et; const t = await r.text(); try{ return JSON.parse(t) }catch(_){ return {} } }catch(_e){ return {} } }
async function writeConfig(cfg){ try{ const { configUrl } = getCoreUrls(); const et=window.cedbEtag||''; const headers=Object.assign({ 'Content-Type':'application/json' }, et? { 'If-Match': et } : {}); const body=JSON.stringify(cfg,null,2); const r = await fetch(configUrl, { method:'PUT', headers, body, mode:'cors', credentials:'omit' }); if(r.status===412){ document.getElementById('register-status').textContent='‚ùå Conflict ‚Äî refresh and retry'; return false } if(!r.ok){ document.getElementById('register-status').textContent='‚ùå Write failed'; return false } const newEt=r.headers.get('etag'); if(newEt) window.cedbEtag = newEt; return true }catch(_e){ document.getElementById('register-status').textContent='‚ùå Write error'; return false } }
document.getElementById('register-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  let csrf = sessionStorage.getItem('csrf_token');
  if(!csrf){ try{ const a=new Uint8Array(32); crypto.getRandomValues(a); csrf=Array.from(a).map(b=>b.toString(16).padStart(2,'0')).join(''); sessionStorage.setItem('csrf_token', csrf); document.cookie='csrf_token='+csrf+'; SameSite=Strict; Secure; path=/'; }catch(_){ csrf=''; }
  }
  const u = document.getElementById('reg-username').value.trim();
  const p = document.getElementById('reg-password').value.trim();
  const c = document.getElementById('reg-confirm').value.trim();
  if(!u || !p || p!==c){ document.getElementById('register-status').textContent='Enter matching username/password'; return }
  try{
    // read current db via Worker (to keep ETag for write)
    const head = await fetch(WRITE_DB_URL, { method:'HEAD' })
    const et = head.headers.get('etag')||''
    const rows = await (await fetch(WRITE_DB_URL)).json().catch(()=>[])
    if(!Array.isArray(rows)) { document.getElementById('register-status').textContent='‚ùå Invalid db.json'; return }
    const exists = rows.find(r => String(r.prefix||'')==='app_' && String(r.collection||'')==='users' && String(r.metakey||'')==='username' && String(r.metavalue||'')===u)
    if(exists){ document.getElementById('register-status').textContent='‚ùå Username already exists'; return }
    const maxRel = rows.reduce((m,r)=> (String(r.prefix||'')==='app_' && String(r.collection||'')==='users' ? Math.max(m, Number(r.relid||0)) : m), 100)
    const relid = Number(maxRel)+1
    const now = new Date().toISOString()
    const salt = randHex(12)
    const iterations = 100000
    const hash = await pbkdf2Hex(p, salt, iterations, 32)
    rows.push({ id: crypto.randomUUID(), relid, prefix:'app_', collection:'users', metakey:'username', metavalue:u, createddate: now, updateddate: now })
    rows.push({ id: crypto.randomUUID(), relid, prefix:'app_', collection:'users', metakey:'password', metavalue: JSON.stringify({ hash, salt, iterations }), createddate: now, updateddate: now })
    const r = await fetch(WRITE_DB_URL, { method:'PUT', headers: Object.assign({ 'Content-Type':'application/json' }, et? { 'If-Match': et } : {}), body: JSON.stringify(rows, null, 2) })
    if(!r.ok){ document.getElementById('register-status').textContent='‚ùå Registration failed'; return }
    document.getElementById('register-status').textContent='‚úÖ Registered. Sign in now.'
  }catch(_e){ document.getElementById('register-status').textContent='‚ùå Registration error' }
})
</script>
<script>
;(function(){
  function gen(n){ const a=new Uint8Array(n); crypto.getRandomValues(a); return Array.from(a).map(b=>b.toString(16).padStart(2,'0')).join('') }
  let t = sessionStorage.getItem('csrf_token');
  if(!t){ try{ t = gen(32); sessionStorage.setItem('csrf_token', t); document.cookie='csrf_token='+t+'; SameSite=Strict; Secure; path=/'; }catch(_){ t='' } }
  const a=document.getElementById('csrf-login-token'); if(a) a.value = t;
  const b=document.getElementById('csrf-register-token'); if(b) b.value = t;
})();
</script>

<script src="https://translate.zvo.cn/static/translate.min.js"></script>
<script>
translate.element.tagAttribute['textarea']=['placeholder'];
translate.ignore.class.push('botts');
translate.language.setLocal('english');
translate.service.use('client.edge');
translate.listener.start();
translate.execute();
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
  //const moreButton = document.querySelector('.more');
  //const verticalNav = document.getElementById('verticalNav');
  
  //moreButton.addEventListener('click', function(e) {
    //e.stopPropagation(); // Prevent event bubbling
    
    // Toggle the navigation visibility
    //if (verticalNav.style.display === 'none' || verticalNav.style.display === '') {
    //  verticalNav.style.display = 'block';
   // } else {
    //  verticalNav.style.display = 'none';
  //  }
  //});
  
  // Close nav when clicking anywhere outside


// Get the button and menu elements
const menuToggleBtn = document.getElementById('menu-toggle-btn');
const mobileMenu = document.getElementById('mobile-menu-dp');

// Add click event listener to the button
menuToggleBtn.addEventListener('click', function(event) {
    // Toggle the display of the mobile menu
    if (mobileMenu.style.display === 'none' || mobileMenu.style.display === '') {
        mobileMenu.style.display = 'block';
    } else {
        mobileMenu.style.display = 'none';
    }
    
    // Optional: Prevent event bubbling if needed
    event.stopPropagation();
});

// Optional: Close menu when clicking outside
document.addEventListener('click', function(event) {
    if (!mobileMenu.contains(event.target) && !menuToggleBtn.contains(event.target)) {
        mobileMenu.style.display = 'none';
    }
});

});
</script>
</body>
</html>
