<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
</head>
<body>
<div style="display:flex;align-items:center;gap:10px;margin-bottom:16px">
  <img alt="Logo" width="36" height="36" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Crect width='36' height='36' rx='8' fill='%230066ff'/%3E%3Ctext x='18' y='23' font-size='16' text-anchor='middle' fill='white' font-family='Arial'%3EJ%3C/text%3E%3C/svg%3E">
  <span style="font-size:18px;font-weight:600">Admin Login</span>
</div>
<h1>Login</h1>
<div id="status" style="margin-bottom:12px"></div>
<button id="sign-in">Sign in</button>
<button id="sign-out" style="display:none">Sign out</button>
<div style="margin-top:12px"><a href="index.html">Back to Home</a></div>
<!-- Clerk integration: expects `window.__CONFIG.CLERK_PUBLISHABLE_KEY` to be provided at build time -->
<script src="/config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@4/dist/clerk.browser.js"></script>
<script>
async function initClerkLogin(){
  try{
    if(!window.__CONFIG || !window.__CONFIG.CLERK_PUBLISHABLE_KEY){
      document.getElementById('status').textContent = 'Clerk not configured';
      return;
    }
    await Clerk.load({ publishableKey: window.__CONFIG.CLERK_PUBLISHABLE_KEY });
    const clerk = Clerk;
    async function updateUI(){
      try{
        const user = await (clerk.user?.get?.() || clerk.user);
        if(user){
          document.getElementById('status').textContent = 'Signed in as: ' + (user.username || user.email || '');
          document.getElementById('sign-in').style.display='none';
          document.getElementById('sign-out').style.display='';
          window.location.href='admin.html';
        } else {
          document.getElementById('status').textContent = 'Not signed in';
          document.getElementById('sign-in').style.display='';
          document.getElementById('sign-out').style.display='none';
        }
      }catch(_e){ document.getElementById('status').textContent='Not signed in'; }
    }
    document.getElementById('sign-in').addEventListener('click', ()=>{
      clerk.openSignIn && clerk.openSignIn({ redirectUrl: window.location.origin + '/admin.html' });
      if(!clerk.openSignIn){ window.location.href = 'https://clerk.com/sign-in?redirect_url=' + encodeURIComponent(window.location.origin + '/admin.html'); }
    });
    document.getElementById('sign-out').addEventListener('click', async ()=>{
      try{ await clerk.signOut?.(); }catch(_e){}
      updateUI();
    });
    updateUI();
  }catch(e){ document.getElementById('status').textContent = 'Auth init error'; }
}
initClerkLogin();
</script>
</body>
</html>
